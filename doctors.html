<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Doctors</title>
    <!-- bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>

    <h1 class="text-center my-4">Our Doctors</h1>
    <div class="container">
        <div class="row" id="doctors-container">
            <!-- Doctor cards will be rendered here -->
        </div>
    </div>

    <script>
async function loadDoctors() {
  try {
    // Step 1: fetch doctors.json
    const response = await fetch("doctors.json");
    if (!response.ok) throw new Error("Failed to load doctors.json");
    const doctorsFromJson = await response.json();

    // Step 2: get admin-added doctors from localStorage
    const doctorsFromStorage = JSON.parse(localStorage.getItem("doctors")) || [];

    // Step 3: filter localStorage doctors that are not in JSON (by id)
    const storageOnlyDoctors = doctorsFromStorage.filter(
      ds => !doctorsFromJson.some(dj => dj.id === ds.id)
    );

    // Step 4: merge: JSON doctors first, then storage-only doctors
    const allDoctors = [...doctorsFromJson, ...storageOnlyDoctors];

    // Step 5: update localStorage to include all doctors (optional)
    localStorage.setItem("doctors", JSON.stringify(allDoctors));

    // Step 6: render all doctors
    const container = document.getElementById("doctors-container");
    container.innerHTML = "";

    allDoctors.forEach((doc) => {
      const col = document.createElement("div");
      col.className = "col-md-4 mb-4";

      col.innerHTML = `
        <div class="card h-100 shadow-sm d-flex flex-column">
          <img src="${doc.photo}" 
               class="card-img-top" 
               alt="${doc.name}" 
               style="height: 220px; object-fit: cover;">
          <div class="card-body d-flex flex-column justify-content-center text-center">
            <h5 class="card-title mb-2">${doc.name}</h5>
            <p class="card-text text-muted">${doc.specialization}</p>
          </div>
          <div class="card-footer bg-white border-0 text-center mb-2">
            <a href="doctorDetails.html?id=${doc.id}" 
               class="btn btn-sm" 
               style="background-color: #8ABC48; color: white;">
               See Details
            </a>
          </div>
        </div>
      `;
      container.appendChild(col);
    });

  } catch (error) {
    console.error(error);
    document.getElementById("doctors-container").innerHTML =
      '<p class="text-danger text-center">Failed to load doctors information.</p>';
  }
}

window.addEventListener("DOMContentLoaded", loadDoctors);
</script>


</body>
</html>
