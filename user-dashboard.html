<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Dashboard - Hospital BD</title>
  <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    body { padding-top: 70px; }
    .card-stats { background-color: #8ABC48; color: white; }
    table th, table td { vertical-align: middle !important; }
  </style>
</head>
<body>

  <!-- Dashboard Header -->
  <div class="container d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-success" id="welcomeMsg">Welcome, Patient</h2>
    <a href="index.html" class="btn btn-success">Back to Home</a>
  </div>

  <!-- Stats Cards -->
  <div class="container">
    <div class="row mb-4">
      <div class="col-md-6 mb-3">
        <div class="card card-stats p-3 shadow-sm text-center">
          <h5>Total Appointments</h5>
          <h3 id="totalAppointments">0</h3>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <div class="card card-stats p-3 shadow-sm text-center">
          <h5>Upcoming Appointments</h5>
          <h3 id="upcomingAppointments">0</h3>
        </div>
      </div>
    </div>

    <!-- Appointments Table -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">Your Appointments</h5>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>Doctor Name</th>
              <th>Specialization</th>
              <th>Day</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="appointmentsTable">
            <!-- Appointments will load here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Profile Info -->
    <div class="card shadow-sm mb-5">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">Profile Info</h5>
      </div>
      <div class="card-body">
        <p><strong>Name:</strong> <span id="profileName"></span></p>
        <p><strong>Email:</strong> <span id="profileEmail"></span></p>
        <p><strong>Phone:</strong> <span id="profilePhone"></span></p>
      </div>
    </div>
  </div>

  <script>
    // Load Dashboard Data
    document.addEventListener("DOMContentLoaded", () => {
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      if (!currentUser) {
        alert("Please login first!");
        window.location.href = "login.html";
        return;
      }

      document.getElementById("welcomeMsg").textContent = `Welcome, ${currentUser.name}`;
      document.getElementById("profileName").textContent = currentUser.name;
      document.getElementById("profileEmail").textContent = currentUser.email;
      document.getElementById("profilePhone").textContent = currentUser.phone;

      const allAppointments = JSON.parse(localStorage.getItem("appointments")) || [];
      const patientAppointments = allAppointments.filter(app => app.patientEmail === currentUser.email || app.patientPhone === currentUser.phone);

      document.getElementById("totalAppointments").textContent = patientAppointments.length;
      const upcomingCount = patientAppointments.filter(app => new Date(app.day) >= new Date()).length;
      document.getElementById("upcomingAppointments").textContent = upcomingCount;

      const tableBody = document.getElementById("appointmentsTable");
      tableBody.innerHTML = "";
      patientAppointments.forEach((app, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${app.doctorName}</td>
          <td>${app.specialization}</td>
          <td>${app.day}</td>
          <td>
            <button class="btn btn-sm btn-danger deleteBtn">Cancel</button>
          </td>
        `;
        tableBody.appendChild(tr);

        tr.querySelector(".deleteBtn").addEventListener("click", () => {
          if (confirm("Are you sure you want to cancel this appointment?")) {
            const idx = allAppointments.findIndex(a => a.id === app.id);
            if (idx > -1) {
              allAppointments.splice(idx, 1);
              localStorage.setItem("appointments", JSON.stringify(allAppointments));
              window.location.reload();
            }
          }
        });
      });

      // Logout
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("currentUser");
          window.location.href = "index.html";
        });
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
